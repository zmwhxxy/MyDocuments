{"id":"01hvjay060r00wma9dp0srv02s","add_time_ms":1713233658049,"type":"doc","title":"生命周期-小程序更新机制","_id":"131","char_count":{"word":433,"char_without_spaces":641,"char_with_spaces":804,"char_all":839},"content":"在访问小程序时，微信会将小程序代码包缓存到本地。\n开发者在发布了新的小程序版本以后，微信客户端会检查本地缓存的小程序有没有新版本，并进行小程序代码包的更新。\n\n小程序的更新机制有两种：\n1.启动时同步更新：微信运行时，会定期检查最新使用的小程序是否有更新。如果有更新，下次小程序启动时会同步进行更新，更新到最新版本后再打开程序。如果用户长时间未使用小程序时，会强制同步检查版本更新。\n\n2.启动时异步更新：在启动前没有发现更新，小程序每次冷启动时，都会异步检查是否有版本更新。如果发现有新版本，将会异步下载新版本的代码包，将新版本的小程序在下一次启动进行使用，当前访问使用的依然是本地的旧版本代码。\n\n\n在启动异步更新的情况下，如果开发者希望立刻进行版本更新，可以使用wx.getUpdateManager API进行处理。在有新版本时提示用户重启小程序更新版本。\n\n代码示例：\n// app.js\nApp({\n  onLaunch() {\n    // 程序冷启动时，进行更新\n    const updateManager = wx.getUpdateManager();\n    updateManager.onUpdateReady(()=>{\n      wx.showModal({\n        title: '更新提示',\n        content: '新版本已经准备好，是否重启应用？',\n        complete: (res) => {\n          if (res.cancel) {\n            \n          }\n      \n          if (res.confirm) {\n            // 强制更新并重启小程序\n            updateManager.applyUpdate();\n          }\n        }\n      })\n    });\n  }\n})\n","edit_time_ms":1713235142791}