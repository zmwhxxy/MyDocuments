{"id":"01hd970xghp4d6qpkhfpnx51zq","add_time_ms":1697895183889,"icon":"book","type":"doc","title":"打包Debug和Release","_id":"86","content":"## 打包Debug和Release\n\n**注意**: 这个例子对于单配置生成器有效.而对于多配置生成器无效(例如Visual Studio)\n\n默认情况下,CMake模型是一个构建目录只包含一个配置,也就是Debug,Release,MinSizeRel或者RelWithDebInfo等的构建目录.但是是可以通过CPack打包多个构建目录以及构建一个包含同一项目多个配置的包.\n\n首先,我们想要确认debug和release的构建使用不同的可执行和库名字.让我们使用`d`作为调试的可执行和库的后缀.\n\n在顶级`CMakeLists.txt`文件的开头设定`CMAKE_DEBUG_POSTFIX`:\n\n```CMake\nset(CMAKE_DEBUG_POSTFIX d)\n\nadd_library(tutorial_compiler_flags INTERFACE)\n```\n\n给tutorial的可执行文件添加`DEBUG_POSTFIX`属性:\n\n```CMake\nadd_executable(Tutorial tutorial.cxx)\nset_target_properties(Tutorial PROPERTIES DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX})\n\ntarget_link_libraries(Tutorial PUBLIC MathFunctions)\n```\n\n让我们也给MathFunctions库添加版本号.在`MathFunctions/CMakeLists.txt`设定`VERSION`和`SOVERSION`属性:\n\n```CMake\nset_property(TARGET MathFunctions PROPERTY VERSION \"1.0.0\")\nset_property(TARGET MathFunctions PROPERTY SOVERSION \"1\")\n```\n\n从`Step12`目录,创建`debug`和`release`子目录,结构如下:\n\n```\n- Step12\n   - debug\n   - release\n```\n\n现在我们需要设定debug和release构建.我们可以用`CMAKE_BUILD_TYPE`来设定配置类型:\n\n```Shell\ncd debug\ncmake -DCMAKE_BUILD_TYPE=Debug ..\ncmake --build .\ncd ../release\ncmake -DCMAKE_BUILD_TYPE=Release ..\ncmake --build .\n```\n\n现在debug和release的构建都完成了.我们可以用自定义配置文件来将两个构建都打包到同一个发布包中.在`Step12`目录里,创建一个名为`MultiConfig.cmake`的文件.在文件中,首先包含通过`cmake`创建的默认配置文件.\n\n接下来,用`CPACK_INSTALL_CMAKE_PROJECTS`变量来指定安装哪个项目.这时,我们想安装debug和release两个版本:\n\n```CMake\ninclude(\"release/CPackConfig.cmake\")\n\nset(CPACK_INSTALL_CMAKE_PROJECTS\n    \"debug;Tutorial;ALL;/\"\n    \"release;Tutorial;ALL;/\"\n    )\n```\n\n从`Step12`目录下,运行`cpack`命令通过`config`选项来指定我们自定义的配置文件:\n\n```Shell\ncpack --config MultiCPackConfig.cmake\n```\n\n\n","edit_time_ms":1697895195503,"char_count":{"word":470,"char_without_spaces":1441,"char_with_spaces":1493,"char_all":1564},"snapshots":[{"id":"01hd9bryfg015tkgzrzcy47vsb","item_id":"01hd970xghp4d6qpkhfpnx51zq","add_time_ms":1697900165616,"hash":"f880c1afb9deedf8fbec1251e7580bba","length":1564,"char_count_char_with_spaces":1493,"char_count_char_without_spaces":1441,"char_count_word":470}]}